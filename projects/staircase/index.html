<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Staircase - Escher Style</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e6e6e6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            padding: 30px 20px 20px;
            z-index: 100;
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 3.2rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff9a00, #ff5e00, #ff0095);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(255, 94, 0, 0.3);
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #b0b0b0;
            max-width: 800px;
            margin: 0 auto 15px;
            line-height: 1.5;
        }

        .tagline {
            color: #ff9a00;
            font-style: italic;
            font-size: 1.1rem;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 20px;
            gap: 30px;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }

        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
            }
        }

        .staircase-container {
            flex: 2;
            position: relative;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .staircase-canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
            perspective: 1000px;
        }

        #staircaseCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls-panel {
            flex: 1;
            min-width: 300px;
            background: rgba(20, 25, 40, 0.85);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 154, 0, 0.2);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            max-height: 600px;
            overflow-y: auto;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #ff9a00;
            border-bottom: 2px solid rgba(255, 154, 0, 0.3);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-label {
            display: block;
            margin-bottom: 12px;
            color: #b0b0b0;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-container {
            margin-bottom: 20px;
        }

        .slider-with-value {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider-value {
            min-width: 50px;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            color: #ff9a00;
        }

        input[type="range"] {
            flex: 1;
            height: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff9a00;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 154, 0, 0.5);
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: #fff;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #ff9a00;
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .btn {
            padding: 16px;
            border-radius: 10px;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(to right, #ff9a00, #ff5e00);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(255, 94, 0, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(to right, #444, #666);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.4);
        }

        .info-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            border-left: 4px solid #ff9a00;
        }

        .info-title {
            color: #ff9a00;
            font-size: 1.3rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-text {
            color: #b0b0b0;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .footer {
            text-align: center;
            padding: 25px;
            color: #888;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .escher-quote {
            font-style: italic;
            margin-top: 10px;
            color: #ff9a00;
        }

        .perspective-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .perspective-btn {
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 154, 0, 0.3);
            color: #e6e6e6;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .perspective-btn:hover {
            background: rgba(255, 154, 0, 0.2);
            transform: translateY(-3px);
        }

        .perspective-btn.active {
            background: rgba(255, 154, 0, 0.3);
            border-color: #ff9a00;
            box-shadow: 0 0 15px rgba(255, 154, 0, 0.3);
        }

        .perspective-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: #ff9a00;
        }

        .staircase-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        .overlay-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 30px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .overlay-text.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 10px;
                gap: 20px;
            }
            
            .button-group, .perspective-controls {
                grid-template-columns: 1fr;
            }
            
            .staircase-container {
                min-height: 400px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            .controls-panel {
                padding: 20px;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-stairs"></i> Infinite Staircase</h1>
        <p class="subtitle">An optical illusion inspired by M.C. Escher's "Ascending and Descending" where stairs appear to go up forever in an impossible loop.</p>
        <p class="tagline">"An impossible reality that challenges perception"</p>
    </div>

    <div class="container">
        <div class="staircase-container">
            <div class="staircase-canvas-container">
                <canvas id="staircaseCanvas"></canvas>
                <div class="staircase-overlay">
                    <div class="overlay-text" id="overlayText">Click and drag to rotate the staircase</div>
                </div>
            </div>
        </div>

        <div class="controls-panel">
            <h2 class="section-title"><i class="fas fa-cogs"></i> Staircase Controls</h2>
            
            <div class="control-group">
                <div class="control-label"><i class="fas fa-tachometer-alt"></i> Animation Speed</div>
                <div class="slider-with-value">
                    <input type="range" id="speedSlider" min="0" max="100" value="50">
                    <div class="slider-value" id="speedValue">50</div>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label"><i class="fas fa-expand-alt"></i> Staircase Size</div>
                <div class="slider-with-value">
                    <input type="range" id="sizeSlider" min="10" max="100" value="60">
                    <div class="slider-value" id="sizeValue">60</div>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label"><i class="fas fa-layer-group"></i> Number of Stairs</div>
                <div class="slider-with-value">
                    <input type="range" id="stairsSlider" min="8" max="24" value="16">
                    <div class="slider-value" id="stairsValue">16</div>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label"><i class="fas fa-eye"></i> Visual Effects</div>
                <div class="toggle-switch">
                    <span>3D Depth</span>
                    <label class="switch">
                        <input type="checkbox" id="depthToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="toggle-switch">
                    <span>Shadows</span>
                    <label class="switch">
                        <input type="checkbox" id="shadowsToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="toggle-switch">
                    <span>Textures</span>
                    <label class="switch">
                        <input type="checkbox" id="texturesToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label"><i class="fas fa-cube"></i> Perspective View</div>
                <div class="perspective-controls">
                    <div class="perspective-btn active" data-view="top">
                        <div class="perspective-icon"><i class="fas fa-download"></i></div>
                        <span>Top Down</span>
                    </div>
                    <div class="perspective-btn" data-view="side">
                        <div class="perspective-icon"><i class="fas fa-arrows-alt-h"></i></div>
                        <span>Side View</span>
                    </div>
                    <div class="perspective-btn" data-view="corner">
                        <div class="perspective-icon"><i class="fas fa-cube"></i></div>
                        <span>Corner View</span>
                    </div>
                    <div class="perspective-btn" data-view="first-person">
                        <div class="perspective-icon"><i class="fas fa-street-view"></i></div>
                        <span>First Person</span>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="autoRotateBtn">
                    <i class="fas fa-sync-alt"></i> Auto-Rotate
                </button>
                <button class="btn btn-secondary" id="resetViewBtn">
                    <i class="fas fa-undo"></i> Reset View
                </button>
            </div>

            <div class="info-panel">
                <div class="info-title"><i class="fas fa-info-circle"></i> About This Illusion</div>
                <div class="info-text">
                    This infinite staircase is inspired by M.C. Escher's famous lithograph "Ascending and Descending" (1960). 
                    The impossible geometry creates the illusion of stairs that continuously ascend (or descend) in a closed loop, 
                    defying the laws of perspective and gravity. Use your mouse to drag and explore the 3D model from different angles.
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Infinite Staircase &copy; 2023 | Inspired by M.C. Escher's impossible architecture</p>
        <p class="escher-quote">"I can't keep from fooling around with our irrefutable certainties. It is, for example, a pleasure knowingly to mix up two- and three-dimensionalities, flat and spatial, and to make fun of gravity." â€” M.C. Escher</p>
    </div>

    <script>
        // DOM Elements
        const canvas = document.getElementById('staircaseCanvas');
        const ctx = canvas.getContext('2d');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const sizeSlider = document.getElementById('sizeSlider');
        const sizeValue = document.getElementById('sizeValue');
        const stairsSlider = document.getElementById('stairsSlider');
        const stairsValue = document.getElementById('stairsValue');
        const depthToggle = document.getElementById('depthToggle');
        const shadowsToggle = document.getElementById('shadowsToggle');
        const texturesToggle = document.getElementById('texturesToggle');
        const autoRotateBtn = document.getElementById('autoRotateBtn');
        const resetViewBtn = document.getElementById('resetViewBtn');
        const perspectiveBtns = document.querySelectorAll('.perspective-btn');
        const overlayText = document.getElementById('overlayText');

        // Canvas setup
        let canvasWidth, canvasHeight;
        let centerX, centerY;

        // Animation variables
        let animationSpeed = 0.5;
        let rotationAngle = 0;
        let autoRotate = true;
        let mouseDown = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        let cameraAngleX = 30;
        let cameraAngleY = 45;
        let cameraDistance = 400;

        // Staircase parameters
        let staircaseSize = 1.0;
        let numStairs = 16;
        let showDepth = true;
        let showShadows = true;
        let showTextures = true;
        let currentView = 'top';

        // Initialize canvas size
        function initCanvas() {
            const container = canvas.parentElement;
            canvasWidth = container.clientWidth;
            canvasHeight = container.clientHeight;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            centerX = canvasWidth / 2;
            centerY = canvasHeight / 2;
        }

        // Draw the infinite staircase
        function drawStaircase() {
            // Clear canvas with gradient background
            const gradient = ctx.createRadialGradient(
                centerX, centerY, 0,
                centerX, centerY, Math.max(canvasWidth, canvasHeight) / 2
            );
            gradient.addColorStop(0, '#0a0a1a');
            gradient.addColorStop(1, '#1a1a2e');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // Set up transformation for 3D effect
            ctx.save();
            ctx.translate(centerX, centerY);
            
            // Apply rotation based on mouse or auto-rotate
            if (autoRotate) {
                rotationAngle += animationSpeed * 0.01;
            }
            
            // Rotate based on camera angles
            ctx.rotateX = function(angle) {
                // Simulate 3D rotation using 2D transforms
                // In a real 3D context, we would use WebGL
                // For 2D canvas, we simulate with perspective projection
            };
            
            // Draw the staircase
            drawStairs();
            
            ctx.restore();
        }

        // Draw the individual stairs
        function drawStairs() {
            const stairHeight = 20 * staircaseSize;
            const stairDepth = 40 * staircaseSize;
            const stairWidth = 80 * staircaseSize;
            const radius = 150 * staircaseSize;
            
            // Calculate perspective projection
            const perspective = 400;
            
            for (let i = 0; i < numStairs; i++) {
                // Calculate position in circular pattern
                const angle = (i / numStairs) * Math.PI * 2 + rotationAngle;
                const nextAngle = ((i + 1) / numStairs) * Math.PI * 2 + rotationAngle;
                
                // Calculate 3D positions
                const x1 = Math.cos(angle) * radius;
                const y1 = Math.sin(angle) * radius;
                const z1 = i * stairHeight;
                
                const x2 = Math.cos(nextAngle) * radius;
                const y2 = Math.sin(nextAngle) * radius;
                const z2 = (i + 1) * stairHeight;
                
                // Apply camera rotation
                const camX1 = rotateX(x1, z1, cameraAngleX);
                const camZ1 = rotateZ(x1, z1, cameraAngleX);
                const camX2 = rotateX(x2, z2, cameraAngleX);
                const camZ2 = rotateZ(x2, z2, cameraAngleX);
                
                // Apply perspective projection
                const scale1 = perspective / (perspective + camZ1 + cameraDistance);
                const scale2 = perspective / (perspective + camZ2 + cameraDistance);
                
                const projX1 = camX1 * scale1;
                const projY1 = y1 * scale1 - i * stairHeight * 0.3;
                const projX2 = camX2 * scale2;
                const projY2 = y2 * scale2 - (i + 1) * stairHeight * 0.3;
                
                // Draw stair top (platform)
                ctx.fillStyle = showTextures ? getStairColor(i, 'top') : '#8a6d3b';
                ctx.beginPath();
                ctx.moveTo(projX1, projY1);
                ctx.lineTo(projX2, projY2);
                ctx.lineTo(projX2, projY2 + stairDepth * scale2);
                ctx.lineTo(projX1, projY1 + stairDepth * scale1);
                ctx.closePath();
                ctx.fill();
                
                // Draw stair front (riser)
                if (showDepth) {
                    ctx.fillStyle = showTextures ? getStairColor(i, 'front') : '#6d4c41';
                    ctx.beginPath();
                    ctx.moveTo(projX1, projY1 + stairDepth * scale1);
                    ctx.lineTo(projX2, projY2 + stairDepth * scale2);
                    ctx.lineTo(projX2, projY2 + stairDepth * scale2 + stairHeight * scale2);
                    ctx.lineTo(projX1, projY1 + stairDepth * scale1 + stairHeight * scale1);
                    ctx.closePath();
                    ctx.fill();
                }
                
                // Draw stair side
                if (showDepth) {
                    ctx.fillStyle = showTextures ? getStairColor(i, 'side') : '#5d4037';
                    ctx.beginPath();
                    ctx.moveTo(projX2, projY2);
                    ctx.lineTo(projX2, projY2 + stairDepth * scale2);
                    ctx.lineTo(projX2, projY2 + stairDepth * scale2 + stairHeight * scale2);
                    ctx.lineTo(projX2, projY2 + stairHeight * scale2);
                    ctx.closePath();
                    ctx.fill();
                }
                
                // Draw shadows
                if (showShadows) {
                    drawStairShadow(projX1, projY1, projX2, projY2, stairDepth, scale1, scale2, i);
                }
            }
            
            // Draw connecting lines to complete the loop
            ctx.strokeStyle = 'rgba(255, 154, 0, 0.3)';
            ctx.lineWidth = 2;
            
            for (let i = 0; i < numStairs; i += 2) {
                const angle = (i / numStairs) * Math.PI * 2 + rotationAngle;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                const z = i * stairHeight;
                
                const camX = rotateX(x, z, cameraAngleX);
                const camZ = rotateZ(x, z, cameraAngleX);
                const scale = perspective / (perspective + camZ + cameraDistance);
                
                const projX = camX * scale;
                const projY = y * scale - i * stairHeight * 0.3;
                
                if (i > 0) {
                    const prevAngle = ((i-2) / numStairs) * Math.PI * 2 + rotationAngle;
                    const prevX = Math.cos(prevAngle) * radius;
                    const prevY = Math.sin(prevAngle) * radius;
                    const prevZ = (i-2) * stairHeight;
                    
                    const prevCamX = rotateX(prevX, prevZ, cameraAngleX);
                    const prevCamZ = rotateZ(prevX, prevZ, cameraAngleX);
                    const prevScale = perspective / (perspective + prevCamZ + cameraDistance);
                    
                    const prevProjX = prevCamX * prevScale;
                    const prevProjY = prevY * prevScale - (i-2) * stairHeight * 0.3;
                    
                    ctx.beginPath();
                    ctx.moveTo(prevProjX, prevProjY);
                    ctx.lineTo(projX, projY);
                    ctx.stroke();
                }
            }
        }

        // Helper function for 3D rotation around X axis
        function rotateX(x, z, angle) {
            const rad = angle * Math.PI / 180;
            return x * Math.cos(rad) - z * Math.sin(rad);
        }

        // Helper function for 3D rotation around Z axis
        function rotateZ(x, z, angle) {
            const rad = angle * Math.PI / 180;
            return x * Math.sin(rad) + z * Math.cos(rad);
        }

        // Get color for stair based on position and face
        function getStairColor(stairIndex, face) {
            const colors = {
                top: ['#c19a6b', '#b68d5c', '#ab804d', '#a0733e'],
                front: ['#8d6e63', '#7d5e53', '#6d4e43', '#5d3e33'],
                side: ['#795548', '#694538', '#593528', '#492518']
            };
            
            const colorSet = colors[face] || colors.top;
            return colorSet[stairIndex % colorSet.length];
        }

        // Draw shadow for a stair
        function drawStairShadow(x1, y1, x2, y2, depth, scale1, scale2, index) {
            const shadowAlpha = 0.2 - (index / numStairs) * 0.15;
            
            // Shadow under stair
            ctx.fillStyle = `rgba(0, 0, 0, ${shadowAlpha})`;
            ctx.beginPath();
            ctx.moveTo(x1, y1 + depth * scale1);
            ctx.lineTo(x2, y2 + depth * scale2);
            ctx.lineTo(x2, y2 + depth * scale2 + 10 * scale2);
            ctx.lineTo(x1, y1 + depth * scale1 + 10 * scale1);
            ctx.closePath();
            ctx.fill();
            
            // Shadow on side
            ctx.fillStyle = `rgba(0, 0, 0, ${shadowAlpha * 0.7})`;
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2, y2 + depth * scale2);
            ctx.lineTo(x2 + 10 * scale2, y2 + depth * scale2);
            ctx.lineTo(x2 + 10 * scale2, y2);
            ctx.closePath();
            ctx.fill();
        }

        // Animation loop
        function animate() {
            drawStaircase();
            requestAnimationFrame(animate);
        }

        // Update slider values display
        function updateSliderValues() {
            speedValue.textContent = speedSlider.value;
            sizeValue.textContent = sizeSlider.value;
            stairsValue.textContent = stairsSlider.value;
            
            animationSpeed = parseInt(speedSlider.value) / 10;
            staircaseSize = parseInt(sizeSlider.value) / 50;
            numStairs = parseInt(stairsSlider.value);
        }

        // Set camera view based on selected perspective
        function setCameraView(view) {
            currentView = view;
            
            switch(view) {
                case 'top':
                    cameraAngleX = 30;
                    cameraAngleY = 45;
                    cameraDistance = 400;
                    break;
                case 'side':
                    cameraAngleX = 10;
                    cameraAngleY = 90;
                    cameraDistance = 500;
                    break;
                case 'corner':
                    cameraAngleX = 45;
                    cameraAngleY = 45;
                    cameraDistance = 350;
                    break;
                case 'first-person':
                    cameraAngleX = 15;
                    cameraAngleY = 0;
                    cameraDistance = 200;
                    break;
            }
            
            // Update active button
            perspectiveBtns.forEach(btn => {
                if (btn.dataset.view === view) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // Show temporary overlay message
        function showOverlayMessage(message, duration = 3000) {
            overlayText.textContent = message;
            overlayText.classList.add('show');
            
            setTimeout(() => {
                overlayText.classList.remove('show');
            }, duration);
        }

        // Event Listeners
        speedSlider.addEventListener('input', updateSliderValues);
        sizeSlider.addEventListener('input', updateSliderValues);
        stairsSlider.addEventListener('input', updateSliderValues);

        depthToggle.addEventListener('change', () => {
            showDepth = depthToggle.checked;
        });

        shadowsToggle.addEventListener('change', () => {
            showShadows = shadowsToggle.checked;
        });

        texturesToggle.addEventListener('change', () => {
            showTextures = texturesToggle.checked;
        });

        autoRotateBtn.addEventListener('click', () => {
            autoRotate = !autoRotate;
            autoRotateBtn.innerHTML = autoRotate ? 
                '<i class="fas fa-pause"></i> Pause Rotation' : 
                '<i class="fas fa-sync-alt"></i> Auto-Rotate';
            
            showOverlayMessage(autoRotate ? 'Auto-rotation enabled' : 'Auto-rotation paused');
        });

        resetViewBtn.addEventListener('click', () => {
            cameraAngleX = 30;
            cameraAngleY = 45;
            cameraDistance = 400;
            rotationAngle = 0;
            setCameraView('top');
            showOverlayMessage('View reset to default');
        });

        perspectiveBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                setCameraView(btn.dataset.view);
                showOverlayMessage(`Switched to ${btn.dataset.view} view`);
            });
        });

        // Mouse interaction for manual rotation
        canvas.addEventListener('mousedown', (e) => {
            mouseDown = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            canvas.style.cursor = 'grabbing';
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!mouseDown) return;
            
            const deltaX = e.clientX - lastMouseX;
            const deltaY = e.clientY - lastMouseY;
            
            // Rotate based on mouse movement
            cameraAngleY += deltaX * 0.5;
            cameraAngleX = Math.max(10, Math.min(80, cameraAngleX - deltaY * 0.3));
            
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            
            // Disable auto-rotate while manually rotating
            autoRotate = false;
            autoRotateBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Auto-Rotate';
        });

        canvas.addEventListener('mouseup', () => {
            mouseDown = false;
            canvas.style.cursor = 'grab';
        });

        canvas.addEventListener('mouseleave', () => {
            mouseDown = false;
            canvas.style.cursor = 'default';
        });

        canvas.addEventListener('mouseenter', () => {
            canvas.style.cursor = 'grab';
        });

        // Touch support for mobile devices
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            mouseDown = true;
            lastMouseX = e.touches[0].clientX;
            lastMouseY = e.touches[0].clientY;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!mouseDown) return;
            
            const deltaX = e.touches[0].clientX - lastMouseX;
            const deltaY = e.touches[0].clientY - lastMouseY;
            
            cameraAngleY += deltaX * 0.5;
            cameraAngleX = Math.max(10, Math.min(80, cameraAngleX - deltaY * 0.3));
            
            lastMouseX = e.touches[0].clientX;
            lastMouseY = e.touches[0].clientY;
            
            autoRotate = false;
            autoRotateBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Auto-Rotate';
        });

        canvas.addEventListener('touchend', () => {
            mouseDown = false;
        });

        // Initialize and start animation
        window.addEventListener('load', () => {
            initCanvas();
            updateSliderValues();
            setCameraView('top');
            animate();
            
            // Show initial instruction
            setTimeout(() => {
                showOverlayMessage('Click and drag to rotate the staircase', 5000);
            }, 1000);
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            initCanvas();
        });
    </script>
</body>
</html>