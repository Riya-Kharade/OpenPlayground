<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéµ ECHO CHAMBER ¬∑ resonant ideas</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(145deg, #20192b, #151024);
      font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .echo-lab {
      max-width: 1400px;
      width: 100%;
      background: #2f2645d9;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 80px 80px 60px 60px;
      padding: 30px 30px 35px;
      border: 3px solid #c09bdf;
      box-shadow: 0 30px 50px -15px #0b0712, inset 0 0 40px #936fd6;
    }

    /* header with resonance */
    .echo-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      background: #3e315bcc;
      border-radius: 100px;
      padding: 12px 35px 12px 40px;
      margin-bottom: 30px;
      border: 2px solid #dbb9ff;
    }

    .title-echo {
      display: flex;
      align-items: center;
      gap: 18px;
    }

    .title-echo h1 {
      font-size: 3rem;
      font-weight: 500;
      background: linear-gradient(145deg, #f0d6ff, #cfb0ff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: 2px;
    }

    .echo-counter {
      background: #624d8f;
      border-radius: 60px;
      padding: 10px 30px;
      color: #f3e7ff;
      font-weight: 600;
      font-size: 1.5rem;
      border: 2px solid #dbb9ff;
    }

    /* main chamber */
    .chamber {
      display: flex;
      flex-wrap: wrap;
      gap: 25px;
      margin-bottom: 30px;
    }

    /* sound garden (visual echoes) */
    .garden {
      flex: 2;
      min-width: 400px;
      background: #332a47b3;
      border-radius: 70px;
      padding: 25px;
      border: 3px solid #c9a7ff;
    }

    .garden-label {
      display: flex;
      align-items: center;
      gap: 12px;
      color: #ebdbff;
      font-size: 1.8rem;
      margin-bottom: 20px;
      padding-left: 15px;
    }

    #echoCanvas {
      display: block;
      width: 100%;
      height: auto;
      background: #1e1633;
      border-radius: 60px;
      border: 2px solid #b28dff;
      cursor: pointer;
    }

    /* control panel */
    .echo-controls {
      flex: 1;
      min-width: 300px;
      background: #332a47b3;
      border-radius: 70px;
      padding: 30px 25px;
      border: 3px solid #c9a7ff;
    }

    .sound-palette h3 {
      color: #eeddff;
      font-size: 2rem;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .tone-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-bottom: 35px;
    }

    .tone-chip {
      background: #4d3d72;
      border-radius: 60px;
      padding: 18px 22px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      border: 3px solid #c7abff;
      box-shadow: 0 7px 0 #352b52;
      cursor: pointer;
      transition: 0.07s;
      width: 120px;
    }

    .tone-chip:active {
      transform: translateY(7px);
      box-shadow: 0 0px 0 #352b52;
    }

    .tone-emoji {
      font-size: 3rem;
    }

    .tone-name {
      font-size: 1.2rem;
      color: #f2e6ff;
      font-weight: 500;
    }

    .tone-freq {
      background: #28213e;
      border-radius: 30px;
      padding: 4px 14px;
      color: #b7d0ff;
      font-size: 0.9rem;
    }

    /* echo parameters */
    .echo-params {
      background: #28213e;
      border-radius: 60px;
      padding: 25px 20px;
      border: 2px solid #b797ff;
    }

    .param-slider {
      margin-bottom: 25px;
    }

    .param-slider label {
      display: block;
      color: #dcc9ff;
      font-size: 1.3rem;
      margin-bottom: 10px;
    }

    input[type=range] {
      width: 100%;
      height: 8px;
      background: #4f3e70;
      border-radius: 10px;
    }

    .echo-btn {
      background: #7b62b3;
      border: none;
      color: #f2e2ff;
      font-size: 1.6rem;
      padding: 15px 25px;
      border-radius: 60px;
      width: 100%;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      cursor: pointer;
      box-shadow: 0 8px 0 #4d3980;
      transition: 0.07s;
      border: 2px solid #e5c9ff;
      margin-top: 15px;
    }

    .echo-btn:active {
      transform: translateY(8px);
      box-shadow: 0 1px 0 #4d3980;
    }

    /* echo history */
    .echo-history {
      margin-top: 25px;
      background: #2f2547b3;
      border-radius: 60px;
      padding: 20px 25px;
      border: 2px solid #c3a1ff;
    }

    .history-header {
      display: flex;
      align-items: center;
      gap: 15px;
      color: #e9d9ff;
      font-size: 1.6rem;
      margin-bottom: 15px;
    }

    .history-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      min-height: 80px;
    }

    .echo-chip {
      background: #4f3f77;
      border-radius: 50px;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      border: 2px solid #cbadff;
    }

    .echo-chip span {
      font-size: 1.3rem;
      color: #f0e4ff;
    }

    .empty-history {
      color: #ab93d6;
      font-size: 1.4rem;
      padding: 25px 20px;
      border: 2px dashed #9d82d0;
      border-radius: 50px;
      width: 100%;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="echo-lab">
    <div class="echo-header">
      <div class="title-echo">
        <h1>üéµ ECHO CHAMBER</h1>
      </div>
      <div class="echo-counter" id="echoCounter">0 echoes</div>
    </div>

    <!-- main chamber -->
    <div class="chamber">
      <!-- visual sound garden -->
      <div class="garden">
        <div class="garden-label">
          <span>üåä</span> resonance field
        </div>
        <canvas id="echoCanvas" width="700" height="400"></canvas>
      </div>

      <!-- control panel -->
      <div class="echo-controls">
        <div class="sound-palette">
          <h3><span>üéº</span> tone bank</h3>
          <div class="tone-grid" id="toneGrid"></div>
        </div>

        <div class="echo-params">
          <div class="param-slider">
            <label>üéöÔ∏è decay <span id="decayValue">0.95</span></label>
            <input type="range" id="decaySlider" min="0.7" max="0.99" step="0.01" value="0.95">
          </div>
          <div class="param-slider">
            <label>‚è±Ô∏è interval <span id="intervalValue">0.3</span>s</label>
            <input type="range" id="intervalSlider" min="0.1" max="0.8" step="0.05" value="0.3">
          </div>
          <button class="echo-btn" id="clearEchoBtn">üåÄ clear echoes</button>
        </div>
      </div>
    </div>

    <!-- echo history -->
    <div class="echo-history">
      <div class="history-header">
        <span>üìª</span> echo trail
      </div>
      <div class="history-grid" id="historyContainer">
        <div class="empty-history">‚ú® tap canvas to create echoes</div>
      </div>
    </div>
  </div>

  <script>
    (function() {
      const canvas = document.getElementById('echoCanvas');
      const ctx = canvas.getContext('2d');
      const toneGrid = document.getElementById('toneGrid');
      const historyContainer = document.getElementById('historyContainer');
      const echoCounter = document.getElementById('echoCounter');
      const decaySlider = document.getElementById('decaySlider');
      const intervalSlider = document.getElementById('intervalSlider');
      const decayValue = document.getElementById('decayValue');
      const intervalValue = document.getElementById('intervalValue');
      const clearBtn = document.getElementById('clearEchoBtn');

      // resize canvas
      let width = canvas.width;
      let height = canvas.height;
      function resizeCanvas() {
        const container = document.querySelector('.garden');
        if (!container) return;
        const w = container.clientWidth - 50;
        canvas.width = w;
        canvas.height = 400;
        width = canvas.width;
        height = canvas.height;
      }
      window.addEventListener('resize', resizeCanvas);
      setTimeout(resizeCanvas, 50);

      // ---- tone library ----
      const tones = [
        { emoji: 'üîî', name: 'bell', freq: 440 },
        { emoji: 'üé∏', name: 'guitar', freq: 220 },
        { emoji: 'üéπ', name: 'piano', freq: 330 },
        { emoji: 'üéª', name: 'violin', freq: 550 },
        { emoji: 'ü•Å', name: 'drum', freq: 120 },
        { emoji: 'ü™á', name: 'shaker', freq: 800 }
      ];

      // state
      let activeTone = tones[0]; // default
      let echoes = []; // { x, y, tone, age, id, volume }
      let echoHistory = []; // store last 10 unique echoes

      // parameters
      let decay = 0.95;
      let interval = 0.3; // seconds

      // render tone palette
      function renderTones() {
        let html = '';
        tones.forEach((t, idx) => {
          html += `
            <div class="tone-chip ${idx === 0 ? 'active' : ''}" data-index="${idx}">
              <span class="tone-emoji">${t.emoji}</span>
              <span class="tone-name">${t.name}</span>
              <span class="tone-freq">${t.freq}Hz</span>
            </div>
          `;
        });
        toneGrid.innerHTML = html;

        document.querySelectorAll('.tone-chip').forEach((chip, idx) => {
          chip.addEventListener('click', () => {
            document.querySelectorAll('.tone-chip').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            activeTone = tones[idx];
          });
        });
      }

      // draw echoes on canvas
      function drawEchoes() {
        ctx.clearRect(0, 0, width, height);

        // draw subtle grid
        ctx.strokeStyle = '#4f3d7a';
        ctx.lineWidth = 0.5;
        for (let i = 0; i < width; i += 40) {
          ctx.beginPath();
          ctx.moveTo(i, 0);
          ctx.lineTo(i, height);
          ctx.strokeStyle = '#3a2d58';
          ctx.stroke();
        }
        for (let i = 0; i < height; i += 40) {
          ctx.beginPath();
          ctx.moveTo(0, i);
          ctx.lineTo(width, i);
          ctx.strokeStyle = '#3a2d58';
          ctx.stroke();
        }

        // draw each echo as a ripple
        echoes.forEach(e => {
          const radius = 20 + (1 - e.age) * 40; // age 0-1, older = smaller
          const alpha = Math.max(0, e.age * 0.8);

          ctx.beginPath();
          ctx.arc(e.x, e.y, radius, 0, 2 * Math.PI);
          ctx.strokeStyle = `rgba(255, 200, 255, ${alpha})`;
          ctx.lineWidth = 4;
          ctx.stroke();

          ctx.font = '24px "Segoe UI Emoji", "Apple Color Emoji"';
          ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(e.tone.emoji, e.x, e.y - 10);

          // draw frequency
          ctx.font = '12px monospace';
          ctx.fillStyle = `rgba(200, 220, 255, ${alpha})`;
          ctx.fillText(e.tone.freq + 'Hz', e.x, e.y + 25);
        });
      }

      // update echoes (age them)
      function updateEchoes() {
        echoes = echoes.filter(e => {
          e.age *= decay; // decay factor
          return e.age > 0.05; // remove when too faint
        });
        drawEchoes();
        updateCounter();
      }

      // add new echo at click position
      function addEcho(x, y) {
        const newEcho = {
          id: 'echo_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
          x, y,
          tone: activeTone,
          age: 1.0,
          volume: 1.0
        };
        echoes.push(newEcho);

        // add to history (limited to 8)
        echoHistory.unshift({
          id: newEcho.id,
          tone: activeTone,
          time: new Date().toLocaleTimeString().slice(0,5)
        });
        if (echoHistory.length > 8) echoHistory.pop();
        renderHistory();

        drawEchoes();
      }

      // canvas click handler
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const x = (e.clientX - rect.left) * scaleX;
        const y = (e.clientY - rect.top) * scaleY;
        addEcho(x, y);
      });

      // echo generation loop (auto-echo)
      setInterval(() => {
        // generate new echoes based on existing ones?
        if (echoes.length > 0) {
          // each existing echo spawns a weaker copy nearby
          const newEchoes = [];
          echoes.forEach(e => {
            if (Math.random() < 0.3) { // 30% chance to echo
              const angle = Math.random() * Math.PI * 2;
              const dist = 40 + Math.random() * 60;
              const nx = e.x + Math.cos(angle) * dist;
              const ny = e.y + Math.sin(angle) * dist;
              // keep in bounds
              if (nx > 20 && nx < width - 20 && ny > 20 && ny < height - 20) {
                newEchoes.push({
                  id: 'echo_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
                  x: nx,
                  y: ny,
                  tone: e.tone,
                  age: e.age * 0.7 // weaker
                });
              }
            }
          });
          echoes = [...echoes, ...newEchoes];
        }
        updateEchoes();
      }, interval * 1000);

      // update counter
      function updateCounter() {
        echoCounter.innerText = echoes.length + ' echo' + (echoes.length !== 1 ? 'es' : '');
      }

      // render history
      function renderHistory() {
        if (echoHistory.length === 0) {
          historyContainer.innerHTML = '<div class="empty-history">‚ú® tap canvas to create echoes</div>';
          return;
        }
        let html = '';
        echoHistory.forEach(h => {
          html += `
            <div class="echo-chip">
              <span>${h.tone.emoji}</span>
              <span>${h.tone.name}</span>
              <span>${h.time}</span>
            </div>
          `;
        });
        historyContainer.innerHTML = html;
      }

      // clear all echoes
      clearBtn.addEventListener('click', () => {
        echoes = [];
        drawEchoes();
        updateCounter();
      });

      // slider updates
      decaySlider.addEventListener('input', (e) => {
        decay = parseFloat(e.target.value);
        decayValue.innerText = decay.toFixed(2);
      });
      intervalSlider.addEventListener('input', (e) => {
        interval = parseFloat(e.target.value);
        intervalValue.innerText = interval.toFixed(2);
      });

      // initialize
      renderTones();

      // demo echoes
      function initDemo() {
        setTimeout(() => {
          addEcho(300, 200);
          addEcho(500, 280);
          addEcho(200, 350);
        }, 200);
      }
      initDemo();
    })();
  </script>
</body>
</html>