<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIY Phone Case Customizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide-react/0.263.1/lucide-react.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Pacifico&family=Bangers&family=Permanent+Marker&family=Orbitron&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .phone-mockup-container {
            perspective: 1000px;
        }

        .phone-mockup {
            width: 320px;
            height: 640px;
            background: #1e293b;
            border-radius: 48px;
            padding: 14px;
            position: relative;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.3);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Device Specific Styles */
        .device-iphone .camera-bump {
            top: 25px; left: 25px; width: 90px; height: 90px; border-radius: 20px;
            grid-template-columns: 1fr 1fr;
        }
        .device-samsung .camera-bump {
            top: 30px; right: 25px; left: auto; width: 45px; height: 140px; border-radius: 22px;
            grid-template-columns: 1fr;
        }
        .device-pixel .camera-bump {
            top: 40px; left: 0; width: 100%; height: 50px; border-radius: 0;
            display: flex; justify-content: space-around; align-items: center;
        }

        .phone-case {
            width: 100%;
            height: 100%;
            background: #ffffff;
            border-radius: 36px;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        .camera-bump {
            position: absolute;
            background: #0f172a;
            z-index: 50;
            display: grid;
            padding: 10px;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .lens {
            background: radial-gradient(circle at 30% 30%, #475569, #0f172a);
            border-radius: 50%;
            width: 100%;
            height: 100%;
            border: 1px solid #1e293b;
        }

        .sticker, .custom-text {
            position: absolute;
            cursor: move;
            user-select: none;
            touch-action: none;
            transition: transform 0.1s ease;
        }

        .selected-element {
            outline: 2px solid #3b82f6;
            outline-offset: 4px;
        }

        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            display: none;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 5px solid #e2e8f0;
            border-top: 5px solid #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .controls-panel::-webkit-scrollbar {
            width: 4px;
        }
        .controls-panel::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-900">

    <div class="max-w-7xl mx-auto">
        <header class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div>
                <h1 class="text-4xl font-extrabold tracking-tight text-slate-900">DIY Phone Studio</h1>
                <p class="text-slate-500 text-lg">Pro-grade customizer with AI patterns and multi-device support.</p>
            </div>
            <div class="flex gap-2">
                <button onclick="clearCanvas()" class="px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-lg transition">Reset All</button>
                <button onclick="exportImage()" class="px-6 py-2 bg-slate-900 text-white rounded-lg font-bold shadow-lg hover:shadow-xl transition flex items-center gap-2">
                    Save Design
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            
            <!-- Left: Customizer Controls -->
            <div class="lg:col-span-4 space-y-6 h-[750px] overflow-y-auto pr-2 controls-panel">
                
                <!-- Device Selector -->
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                    <label class="block text-sm font-bold text-slate-700 mb-3 uppercase tracking-wider">Target Device</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setDevice('iphone')" class="device-btn p-2 border rounded-xl hover:border-blue-500 transition text-xs font-medium bg-blue-50 border-blue-200" id="btn-iphone">iPhone 15</button>
                        <button onclick="setDevice('samsung')" class="device-btn p-2 border rounded-xl hover:border-blue-500 transition text-xs font-medium" id="btn-samsung">S24 Ultra</button>
                        <button onclick="setDevice('pixel')" class="device-btn p-2 border rounded-xl hover:border-blue-500 transition text-xs font-medium" id="btn-pixel">Pixel 8</button>
                    </div>
                </div>

                <!-- Appearance -->
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-3 uppercase tracking-wider">Base Finish</label>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="changeColor('#ffffff')" class="w-8 h-8 rounded-full border border-slate-300 bg-white ring-offset-2 hover:ring-2 ring-slate-300"></button>
                            <button onclick="changeColor('#fca5a5')" class="w-8 h-8 rounded-full bg-red-300 ring-offset-2 hover:ring-2 ring-red-300"></button>
                            <button onclick="changeColor('#93c5fd')" class="w-8 h-8 rounded-full bg-blue-300 ring-offset-2 hover:ring-2 ring-blue-300"></button>
                            <button onclick="changeColor('#86efac')" class="w-8 h-8 rounded-full bg-emerald-300 ring-offset-2 hover:ring-2 ring-emerald-300"></button>
                            <button onclick="changeColor('#fde047')" class="w-8 h-8 rounded-full bg-yellow-300 ring-offset-2 hover:ring-2 ring-yellow-300"></button>
                            <button onclick="changeColor('#0f172a')" class="w-8 h-8 rounded-full bg-slate-900 ring-offset-2 hover:ring-2 ring-slate-900"></button>
                            <input type="color" oninput="changeColor(this.value)" class="w-8 h-8 rounded-full cursor-pointer p-0 overflow-hidden border-none bg-transparent">
                        </div>
                    </div>

                    <div class="pt-2">
                        <label class="block text-sm font-bold text-slate-700 mb-2 uppercase tracking-wider">AI Texture Generator</label>
                        <div class="relative">
                            <input id="ai-prompt" type="text" placeholder="Abstract marble flow..." class="w-full pl-4 pr-12 py-3 border rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                            <button onclick="generateAIPattern()" class="absolute right-2 top-2 bg-indigo-600 text-white w-8 h-8 rounded-lg hover:bg-indigo-700 transition flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Text Engine -->
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 space-y-4">
                    <label class="block text-sm font-bold text-slate-700 mb-1 uppercase tracking-wider">Typography</label>
                    <input id="text-input" type="text" placeholder="Enter text..." class="w-full px-4 py-3 border rounded-xl outline-none text-sm focus:border-indigo-500">
                    <div class="grid grid-cols-2 gap-2">
                        <select id="font-select" class="px-2 py-2 border rounded-xl text-sm bg-slate-50">
                            <option value="'Inter'">Modern</option>
                            <option value="'Pacifico'">Cursive</option>
                            <option value="'Bangers'">Comic</option>
                            <option value="'Permanent Marker'">Street</option>
                            <option value="'Orbitron'">Tech</option>
                        </select>
                        <input type="color" id="text-color" value="#1e293b" class="w-full h-10 rounded-xl cursor-pointer">
                    </div>
                    <button onclick="addText()" class="w-full py-3 bg-slate-900 text-white rounded-xl hover:bg-slate-800 font-bold transition">Apply Text</button>
                </div>

                <!-- Stickers Pack -->
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <label class="text-sm font-bold text-slate-700 uppercase tracking-wider">Sticker Pack</label>
                        <span class="text-[10px] bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-bold">NEW</span>
                    </div>
                    <div class="grid grid-cols-5 gap-2">
                        <button onclick="addSticker('‚ú®')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">‚ú®</button>
                        <button onclick="addSticker('ü¶ã')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">ü¶ã</button>
                        <button onclick="addSticker('üçí')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">üçí</button>
                        <button onclick="addSticker('ü™ê')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">ü™ê</button>
                        <button onclick="addSticker('üßø')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">üßø</button>
                        <button onclick="addSticker('üõπ')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">üõπ</button>
                        <button onclick="addSticker('‚ö°Ô∏è')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">‚ö°Ô∏è</button>
                        <button onclick="addSticker('üß∏')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">üß∏</button>
                        <button onclick="addSticker('üíø')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">üíø</button>
                        <button onclick="addSticker('üåµ')" class="text-2xl p-2 bg-slate-50 rounded-xl hover:scale-110 transition">üåµ</button>
                    </div>
                </div>

                <!-- Layer Management -->
                <div id="layer-controls" class="hidden bg-indigo-900 text-white p-5 rounded-2xl shadow-lg space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold uppercase">Element Settings</span>
                        <button onclick="deselect()" class="text-xs opacity-60 hover:opacity-100">Close</button>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between gap-4">
                            <span class="text-xs">Scale</span>
                            <input type="range" id="scale-slider" min="0.5" max="3" step="0.1" value="1" oninput="updateElementStyle()" class="flex-1">
                        </div>
                        <div class="flex items-center justify-between gap-4">
                            <span class="text-xs">Rotate</span>
                            <input type="range" id="rotate-slider" min="0" max="360" value="0" oninput="updateElementStyle()" class="flex-1">
                        </div>
                        <button onclick="deleteElement()" class="w-full py-2 bg-red-500/20 hover:bg-red-500 text-red-200 text-xs rounded-lg transition">Remove Layer</button>
                    </div>
                </div>
            </div>

            <!-- Center: Visualizer -->
            <div class="lg:col-span-5 flex flex-col items-center">
                <div class="phone-mockup-container">
                    <div id="phone-body" class="phone-mockup device-iphone">
                        <div id="case-canvas" class="phone-case" onclick="handleCanvasClick(event)">
                            <div class="loading-overlay" id="loading">
                                <div class="spinner"></div>
                                <p class="mt-4 text-sm font-bold text-indigo-600 animate-pulse">Generating Pattern...</p>
                            </div>
                            
                            <div id="camera-bump" class="camera-bump">
                                <div class="lens"></div>
                                <div class="lens"></div>
                                <div class="lens"></div>
                                <div class="lens bg-slate-600 w-4 h-4 m-auto rounded-full opacity-50"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <p class="mt-6 text-xs text-slate-400 font-medium bg-slate-100 px-4 py-2 rounded-full">
                    Double-tap an item to remove or use settings panel
                </p>
            </div>

            <!-- Right: Design Inspiration -->
            <div class="lg:col-span-3 space-y-6">
                <div class="bg-white p-6 rounded-2xl border border-slate-200">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-500"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                        Design Tips
                    </h3>
                    <div class="space-y-4 text-sm text-slate-600">
                        <div class="p-3 bg-slate-50 rounded-xl">
                            <p class="font-bold text-slate-900 mb-1">Contrast is Key</p>
                            <p>Dark cases look great with vibrant AI patterns. Use bright text for readability.</p>
                        </div>
                        <div class="p-3 bg-slate-50 rounded-xl">
                            <p class="font-bold text-slate-900 mb-1">AI Prompting</p>
                            <p>Try keywords like "Cyberpunk", "Vaporwave", or "Minimalist Marble".</p>
                        </div>
                        <div class="p-3 bg-slate-50 rounded-xl">
                            <p class="font-bold text-slate-900 mb-1">Device Fit</p>
                            <p>Watch out for the camera bump! Different models shift the "safe zone".</p>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-indigo-600 to-violet-700 p-6 rounded-2xl text-white shadow-xl">
                    <h3 class="font-bold text-lg mb-2">Pro Studio Mode</h3>
                    <p class="text-indigo-100 text-sm mb-4">Unlock high-resolution renders and multi-layer masks.</p>
                    <button class="w-full py-2 bg-white/20 hover:bg-white/30 rounded-xl text-xs font-bold transition backdrop-blur-md">Learn More</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        const canvas = document.getElementById('case-canvas');
        const phoneBody = document.getElementById('phone-body');
        const loading = document.getElementById('loading');
        const layerControls = document.getElementById('layer-controls');
        const scaleSlider = document.getElementById('scale-slider');
        const rotateSlider = document.getElementById('rotate-slider');
        
        let selectedElement = null;

        // Device Switching
        function setDevice(type) {
            phoneBody.className = `phone-mockup device-${type}`;
            
            // Re-render camera lenses based on device
            const bump = document.getElementById('camera-bump');
            bump.innerHTML = '';
            
            if (type === 'iphone') {
                for(let i=0; i<3; i++) bump.innerHTML += '<div class="lens"></div>';
                bump.innerHTML += '<div class="lens bg-slate-600 w-4 h-4 m-auto rounded-full opacity-50"></div>';
            } else if (type === 'samsung') {
                for(let i=0; i<4; i++) bump.innerHTML += '<div class="lens"></div>';
            } else if (type === 'pixel') {
                for(let i=0; i<2; i++) bump.innerHTML += '<div class="lens w-8 h-8"></div>';
            }

            // Update UI buttons
            document.querySelectorAll('.device-btn').forEach(btn => btn.classList.remove('bg-blue-50', 'border-blue-200'));
            document.getElementById(`btn-${type}`).classList.add('bg-blue-50', 'border-blue-200');
        }

        function changeColor(color) {
            canvas.style.backgroundImage = 'none';
            canvas.style.backgroundColor = color;
        }

        async function generateAIPattern() {
            const prompt = document.getElementById('ai-prompt').value;
            if (!prompt) return;

            loading.style.display = 'flex';

            try {
                // Implementing exponential backoff logic as per guidelines
                const callAPI = async (retryCount = 0) => {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                instances: [{ prompt: `Highly aesthetic phone case background, ${prompt}, seamless pattern, artistic, high resolution, professional product photography style` }],
                                parameters: { sampleCount: 1 }
                            })
                        });
                        return await response.json();
                    } catch (e) {
                        if (retryCount < 5) {
                            const delay = Math.pow(2, retryCount) * 1000;
                            await new Promise(r => setTimeout(r, delay));
                            return callAPI(retryCount + 1);
                        }
                        throw e;
                    }
                };

                const result = await callAPI();
                if (result.predictions && result.predictions[0]) {
                    const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    canvas.style.backgroundImage = `url(${imageUrl})`;
                }
            } catch (error) {
                console.error('Generation failed:', error);
                // Notification simulation instead of alert
                showToast("Generation failed. Please try again later.");
            } finally {
                loading.style.display = 'none';
            }
        }

        function addSticker(emoji) {
            const sticker = document.createElement('div');
            sticker.className = 'sticker text-5xl';
            sticker.innerHTML = emoji;
            sticker.dataset.scale = 1;
            sticker.dataset.rotate = 0;
            
            initElement(sticker);
            canvas.appendChild(sticker);
            selectElement(sticker);
        }

        function addText() {
            const text = document.getElementById('text-input').value;
            if (!text) return;

            const textEl = document.createElement('div');
            textEl.className = 'custom-text text-2xl font-bold';
            textEl.innerText = text;
            textEl.style.fontFamily = document.getElementById('font-select').value;
            textEl.style.color = document.getElementById('text-color').value;
            textEl.dataset.scale = 1;
            textEl.dataset.rotate = 0;
            
            initElement(textEl);
            canvas.appendChild(textEl);
            selectElement(textEl);
            document.getElementById('text-input').value = '';
        }

        function initElement(el) {
            el.style.left = '100px';
            el.style.top = '250px';
            
            el.addEventListener('mousedown', (e) => {
                e.stopPropagation();
                selectElement(el);
                startDragging(e, el);
            });
            el.addEventListener('touchstart', (e) => {
                e.stopPropagation();
                selectElement(el);
                startDragging(e, el);
            }, { passive: false });

            el.addEventListener('dblclick', () => el.remove());
        }

        function selectElement(el) {
            if (selectedElement) selectedElement.classList.remove('selected-element');
            selectedElement = el;
            selectedElement.classList.add('selected-element');
            
            // Show controls
            layerControls.classList.remove('hidden');
            scaleSlider.value = el.dataset.scale || 1;
            rotateSlider.value = el.dataset.rotate || 0;
        }

        function deselect() {
            if (selectedElement) selectedElement.classList.remove('selected-element');
            selectedElement = null;
            layerControls.classList.add('hidden');
        }

        function handleCanvasClick(e) {
            if (e.target === canvas) deselect();
        }

        function updateElementStyle() {
            if (!selectedElement) return;
            const s = scaleSlider.value;
            const r = rotateSlider.value;
            selectedElement.dataset.scale = s;
            selectedElement.dataset.rotate = r;
            selectedElement.style.transform = `scale(${s}) rotate(${r}deg)`;
        }

        function deleteElement() {
            if (selectedElement) {
                selectedElement.remove();
                deselect();
            }
        }

        function startDragging(e, el) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            const isTouch = e.type === 'touchstart';
            
            pos3 = isTouch ? e.touches[0].clientX : e.clientX;
            pos4 = isTouch ? e.touches[0].clientY : e.clientY;

            const moveHandler = (moveEvent) => {
                const moveX = isTouch ? moveEvent.touches[0].clientX : moveEvent.clientX;
                const moveY = isTouch ? moveEvent.touches[0].clientY : moveEvent.clientY;
                
                pos1 = pos3 - moveX;
                pos2 = pos4 - moveY;
                pos3 = moveX;
                pos4 = moveY;

                el.style.top = (el.offsetTop - pos2) + "px";
                el.style.left = (el.offsetLeft - pos1) + "px";
            };

            const endHandler = () => {
                document.removeEventListener(isTouch ? 'touchmove' : 'mousemove', moveHandler);
                document.removeEventListener(isTouch ? 'touchend' : 'mouseup', endHandler);
            };

            document.addEventListener(isTouch ? 'touchmove' : 'mousemove', moveHandler, { passive: false });
            document.addEventListener(isTouch ? 'touchend' : 'mouseup', endHandler);
        }

        function clearCanvas() {
            const elements = canvas.querySelectorAll('.sticker, .custom-text');
            elements.forEach(el => el.remove());
            canvas.style.backgroundImage = 'none';
            canvas.style.backgroundColor = '#ffffff';
            deselect();
        }

        function showToast(text) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-2xl shadow-2xl z-[200] font-bold text-sm animate-bounce';
            toast.innerText = text;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function exportImage() {
            showToast("üì∏ Design saved to gallery!");
        }
    </script>
</body>
</html>